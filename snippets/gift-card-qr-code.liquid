{%- comment -%}
	Code to run the QR Code generation of the gift card page

	Usage:
	{%- render 'gift-card-qr-code' -%}

{%- endcomment -%}
<script>
	var string = { qrImageAlt: {{ 'gift_cards.issued.qr_image_alt' | t | json }} };

	/**
	 * QR CODE
	 */
	document.addEventListener('DOMContentLoaded', () => {
		const qrElement = document.querySelector('[data-qr-code]');

		if (!qrElement)
			return;

		new QRCode(qrElement, {
			text: qrElement?.dataset?.identifier,
			width: 100,
			height: 100,
			imageAltText: string.qrImageAlt
		});

		var template = document.getElementsByTagName("template")[0];
		var clonedTemplate = template.content.cloneNode(true);
		var isMessageDisplayed = false;
		const copyBtn = document.querySelector('[data-copy-btn]');

		if (!copyBtn)
			return;
	
		/**
		 * COPY BUTTON CODE
		 */
		copyBtn.addEventListener('click', () => {
			const cardCode = document.getElementById('gift-card-code')?.innerText;
	
			if (!cardCode)
				return;
				
			navigator.clipboard.writeText(cardCode).then(() => {
				if (isMessageDisplayed)
					return;
							
				const copySuccess = document.querySelector('[data-gift-copy-success]');
							
				if (!copySuccess)
					return;
							
				copySuccess.appendChild(clonedTemplate);
				isMessageDisplayed = true
			});
		});
	});
</script>
