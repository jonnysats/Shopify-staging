{{ 'article.css' | asset_url | stylesheet_tag }}
{%- liquid
	comment
		Split content to insert product list. Content will have to have the comment below in order to work
	endcomment
	assign split_article = article.content | split: '<!-- PRODUCT LIST -->'
	assign article_content_first = split_article[0]
	assign article_content_last = split_article[1]
	assign products = section.settings.product_list
	comment
		Flickity Options
	endcomment
	assign flickity_arrows = false
	assign flickity_dots = false
	assign flickity_loop = true 
	assign flickity_group_cells = false
	assign flickity_adaptive_height = false
-%}
<div class="container-fluid px-0 overflow-hidden">
	<div class="container">
		<div class="row">
			<div class="col-12">
				<div class="link-wrapper pt-4 pb-3 mb-1">
					<a class="text-decoration-none" href="{{ blog.url }}" title="{{ blog.title }}">{%- render 'icons' with 'arrow-right', icon_classes: 'me-2' -%}<span class="link-text">{{ 'blogs.article.return_to' | t }}</span></a>
				</div>
			</div>
		</div>
		<article class="rte">
			<div class="row justify-content-center align-items-center">
				<div class="col-12">
					<header class="mb-lg-2 pt-lg-3 pb-3 pb-lg-5">
						<h1 class="h2 title">{{ article.title }}</h1>
						<div class="date-tags d-lg-flex gap-lg-2">
							<div class="date-wrapper mb-3 mb-lg-0 px-2 d-flex align-items-center">
								{%- render 'icons' with 'date', icon_classes: 'me-2' -%}
								<time datetime="{{ article.created_at | date: '%Y-%m-%d' }}">{{ article.created_at | date: '%e %B, %Y' }}</time>
							</div>
							{%- if article.tags.size > 0 -%}
								<div class="tags border-top d-flex flex-wrap py-3 py-lg-0 mb-3 mb-lg-0">
									{%- for tag in article.tags -%}
										<div class="tag px-3 fw-medium{% if tag == section.settings.featured_tag %} featured{% endif %}">{{ tag }}</div>
									{%- endfor -%}
								</div>
							{%- endif -%}
						</div>
					</header>
				</div>
			</div>
		</article>
	</div>
	{%- if article.image != blank -%}
		{%- render 'responsive-image', image: article.image, image_class: 'img-fluid', lazyloading_style: 'eager', wrapper_class: 'mb-5 mb-lg-6', width: article.image.width, height: article.image.height -%}
	{%- endif -%}
	<div class="container">
		<article class="rte">
			<div class="row">
				<div class="col-12">
					<!-- Article content -->
					<section>
						{%- if article_content_last != nil -%}
							{{ article_content_first }}
						{%- else -%}
							{{ article.content }}
						{%- endif -%}
					</section>
				</div>
			</div>
		</article>
	</div>
</div>
{%- if article_content_last != nil and products.count > 0 -%}
	<section class="section-collection-merchandising-slider">
		{{ 'product-slider-overflow.css' | asset_url | stylesheet_tag }}
		<script src="{{ 'featured-collection-slider.js' | asset_url }}" defer crossorigin="anonymous"></script>
		<div class="product-grid product-grid-overflow product-slider py-lg-3" data-section-id="{{ section.id }}" data-section-type="featuredCollectionSlider">
			{%- if section.settings.heading != blank or section.settings.subheading != blank -%}
				<div class="container">
					<div class="slider-header">
						<div class="row">
							<div class="col col-lg-5 pb-3 pb-lg-4 mb-lg-1">
								{%- if section.settings.heading != blank %}
									<h2 class="header px-1 px-lg-0 pb-1">{{ section.settings.heading }}</h2>
								{%- endif -%}
								{%- if section.settings.subheading != blank %}
									<p class="sub-header px-1 px-lg-0 pe-3 pe-lg-6">{{ section.settings.subheading }}</p>
								{%- endif -%}
							</div>
							<div class="col-7 d-none d-lg-block">
								{%- render 'slider-custom-nav-buttons', justify_style: "end" -%}
							</div>
						</div>
					</div>
					
				</div>
			{%- endif -%}
			<div class="featured-collection-slider-container container-fluid">
				<div class="special-margin">
					<div class="row gx-0 w-100 h-100" data-generic-slider data-arrows="{{ flickity_arrows }}" data-dots="{{ flickity_dots }}" data-loop="{{ flickity_loop }}" data-adaptive-height="{{ flickity_adaptive_height }}" data-group-cells="{{ flickity_group_cells }}">
						{%- liquid
							for product in products
								comment
									First tag (New)
								endcomment
								assign first_tag = nil
								if product.metafields.theme.new == true
									assign first_tag = 'New'
								endif

								comment
									Second tag (% OFF)
								endcomment
								assign second_tag = nil
								
								capture discount_percentage
									render "product-price-discount-percentage", product: product
								endcapture
								
								assign discount_percentage = discount_percentage | strip
								
								if discount_percentage != nil and discount_percentage != blank and discount_percentage != ""
									assign second_tag = discount_percentage | append: '% Off'
								endif
								
								assign product_grid_classes = "pe-3 pe-md-4 pe-lg-custom col-custom col-6 col-md-4 col-lg-3 col-lg-custom flex-lg-row gap-lg-3"
								render 'product-grid', product: product, classes: product_grid_classes, col_sm: 2, col_md: 3, col_lg: 4, show_description: section.settings.show_description, show_swatches: section.settings.show_swatches, first_tag: first_tag, second_tag: second_tag, show_tags_with_info: true
							endfor
						-%}
					</div>
				</div>
			</div>
			<div class="container d-block d-lg-none mt-4">
				<div class="row">
					<div class="col">
						{%- render 'slider-custom-nav-buttons', justify_style: "between" -%}
					</div>
				</div>
			</div>
		</div>
	</section>
	<div class="container">
		<article class="rte">
			<div class="row">
				<div class="col-12">
					<section class="pt-5 pt-lg-3">
						{{ article_content_last }}
					</section>
				</div>
			</div>
		</article>
	</div>
{%- endif -%}
{%- if blog.previous_article != nil or blog.next_article != nil -%}
	<div class="container bg-wrapper mt-lg-4 mb-5 py-4">
		<div class="row prev-next-articles">
				<div class="col-12">
					<div class="prev-next-buttons d-flex justify-content-center gap-3 py-lg-5">
						<div class="btn-wrapper">
							<a class="btn btn-ternary mw-100 w-100" href="{{ blog.previous_article.url }}" title="{{ blog.previous_article.title | escape }}">
								<span class="anim-wrapper">
									<span class="initial">{{ 'blogs.article.previous_article' | t }}</span>
									<span class="end">{{ 'blogs.article.previous_article' | t }}</span>
								</span>
							</a>
						</div>
						{%- if blog.next_article != nil -%}
							<div class="btn-wrapper">
								<a class="btn btn-ternary mw-100 w-100" href="{{ blog.next_article.url }}" title="{{ blog.next_article.title | escape }}">
									<span class="anim-wrapper">
										<span class="initial">{{ 'blogs.article.next_article' | t }}</span>
										<span class="end">{{ 'blogs.article.next_article' | t }}</span>
									</span>
								</a>
							</div>
						{%- endif -%}
					</div>
				</div>
		</div>
	</div>
	<div class="container pt-4 pt-lg-0 pb-lg-3 articles">
		<div class="row row-cols-1 row-cols-lg-2 justify-content-center px-lg-2">
			{%- if blog.previous_article != nil -%}
				{%- render 'article-grid-item', article: blog.previous_article -%}
			{%- endif -%}
			{%- if blog.next_article != nil -%}
				{%- render 'article-grid-item', article: blog.next_article -%}
			{%- endif -%}
		</div>
	</div>
{%- endif -%}
{% schema %}
{
  "name": "Article",
  "class": "section-article",
  "tag": "section",
  "settings": [
	{
		"type": "text",
		"id": "featured_tag",
		"label": "Featured Tag",
		"info": "Featured tag you would like to stand out. The featured tag would have a different background and color than other tags"
	},
	{
		"type": "header",
		"content": "Featured Products"
	},
	{
		"type": "text",
		"id": "heading",
		"label": "Header"
	},
	{
		"type": "inline_richtext",
		"id": "subheading",
		"label": "Subheader"
	},
	{
		"type": "product_list",
		"id": "product_list",
		"label": "Product List"
	},
	{
		"type": "checkbox",
		"id": "show_description",
		"default": true,
		"label": "Show product description"
	},
	{
		"type": "checkbox",
		"id": "show_swatches",
		"default": true,
		"label": "Show product swatches"
	},
	{
		"type": "checkbox",
		"id": "show_percent_off",
		"label": "Show % discount on product grid images",
		"default": true
	}
  ]
}
{% endschema %}