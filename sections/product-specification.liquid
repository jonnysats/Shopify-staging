{%- if section.blocks.size > 0 -%}
	{%- render 'section-padding', padding_amount_top: section.settings.padding_amount_top, padding_amount_bottom: section.settings.padding_amount_bottom -%}
	{{ 'product-specification.css' | asset_url | stylesheet_tag }}
	<div class="container">
		<div class="accordion" id="pdpAccordionSpecs" data-section-id="{{ section.id }}" data-section-type="SpecificationsAccordions">
			{%- for block in section.blocks -%}
				{%- if block.settings.heading != blank -%}
					<div class="accordion-item border-start-0 border-end-0{% if forloop.first == true %} border-top-0{% endif %}" {{ block.shopify_attributes }}>
						<h2 class="accordion-header no-animation{% if block.type == 'installation' %} position-relative overflow-hidden{% endif %}">
							{%- if block.type == 'installation' -%}
								<div class="moving-gradient"><span class="visually-hidden">Gradient bar</span></div>
							{%- endif -%}
							{%- liquid
								comment
								# Remove duplicated wording in case is coming from dynamic Shopify metadata
								endcomment
								assign unique_array = block.settings.heading | handle | split: '-' | uniq | reject: 'and'
								assign unique_array_size = unique_array | size

								comment
								# Have a clean string to remove duplicates
								endcomment
								assign clean_heading = ''

								comment
								# Loop for each unique string wording and make it look human readable
								endcomment
								for string in unique_array
									comment
									# For last word append and for better human readability (Same as Shopify does)
									endcomment
									if forloop.last and unique_array_size > 1
										assign clean_heading = clean_heading | append: ' and '
									endif

									comment
									# Display regular word
									endcomment
									assign clean_heading = clean_heading | append: string
									
									comment
									# If not last word, append commas in between for differentiation
									endcomment
									unless forloop.last
										assign clean_heading = clean_heading | append: ', '
									endunless
								endfor

								comment
								# After heading cleaned and with not repeated words, show on accordion header
								endcomment
								assign clean_heading = clean_heading | strip
							-%}
							{%- comment -%} ?info Important to use a absolute element with duplicated element as JS event.stopPropagation don't fully adapt with BT {%- endcomment -%}
							{%- if block.type == 'installation' -%}
								<div class="absolute-wrapper position-absolute left-0">
									<span class="accordion-button opacity-0">{{ clean_heading }}</span>
									{%- liquid
										assign page_object = product.metafields.theme.product_installation_content | default: block.settings.content_page | default: block.settings.content
										assign download_btn = page_object.metafields.theme.download
									-%}
									{%- if download_btn != blank -%}
										<a class="download-btn d-flex align-items-center justify-content-center" href="{{ download_btn | file_url }}" title="{{ 'products.product.download_pdf' | t | escape }}" download="{{ page_object.title }}">
											{%- render 'icons' with 'download' -%}
											<small>{{ 'products.product.download_pdf' | t }}</small>
										</a>
									{%- endif -%}
								</div>
							{%- endif -%}
							<button class="accordion-button px-0{% unless forloop.first == true and section.settings.open_first == true %} collapsed{% endunless %}" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePdpAccordion{{ block.type | handleize }}" aria-expanded="{% unless forloop.first == true and section.settings.open_first == true %}false{% else %}true{% endunless %}" aria-controls="collapsePdpAccordion{{ block.type | handle }}">
								<span>{{ clean_heading }}</span>
							</button>
						</h2>
						{%- case block.type -%}
							{%- when 'description' -%}
								{%- if product.description != blank or product.excerpt != blank -%}
									<div id="collapsePdpAccordion{{ block.type | handleize }}" class="accordion-collapse collapse{% if forloop.first == true and section.settings.open_first == true %} show{% endif %}">
										<div class="accordion-body pt-0 pb-4 px-0">
											<div class="content-wrapper description-text pt-lg-2">{{- product.description | default: product.excerpt -}}</div>
										</div>
									</div>
								{%- endif -%}
							{%- when 'specification' -%}
								{%- if block.settings.spec_list != blank -%}
									<div id="collapsePdpAccordion{{ block.type | handleize }}" class="accordion-collapse collapse{% if forloop.first == true and section.settings.open_first == true %} show{% endif %}">
										<div class="accordion-body pt-1 pb-4 px-0">
											<div class="content-wrapper pt-2 pt-lg-3">
												{%- for metaobject in block.settings.spec_list -%}
													<div class="spec-wrapper{% unless forloop.first %} mb-3 mt-5 mt-lg-4 pt-lg-3{% endunless %}{% if forloop.last == true %} mb-lg-2{% endif %}">
														{%- if metaobject.title != blank and metaobject.items != blank -%}
															<h3 class="mb-4">{{ metaobject.title }}</h3>
															<div class="row list-wrapper pt-1">
																{%- for item in metaobject.items.value -%}
																	{%- if item.heading != blank and item.content != blank -%}
																		<div class="item-wrapper col-6 col-lg-2">
																			<div class="border-top border-light-subtle py-3">
																				<p class="item-heading mb-2 d-flex align-items-center">{{ item.heading }}{%- if item.tag == true -%}{%- render 'icons' with 'info' -%}{%- endif -%}</p>
																				<div class="pt-1">
																					<p class="fw-semibold mb-0">{{- item.content -}}</p>
																				</div>
																			</div>
																		</div>
																	{%- endif -%}
																{%- endfor -%}
															</div>
														{%- endif -%}
													</div>
												{%- endfor -%}
											</div>
										</div>
									</div>
								{%- endif -%}
							{%- when 'installation' -%}
							{%- assign page_object = product.metafields.theme.product_installation_content | default: block.settings.content_page | default: block.settings.content -%}
							{%- if product.metafields.theme.product_installation_content != blank or block.settings.content_page != blank or block.settings.content != blank -%}
									<div id="collapsePdpAccordion{{ block.type | handleize }}" class="accordion-collapse installation-collapse collapse{% if forloop.first == true and section.settings.open_first == true %} show{% endif %}">
										<div class="accordion-body pt-1 pb-4 px-0 pb-lg-3">
											{%- if page_object.title != blank -%}
												<h2>{{ page_object.title }}</h2>
											{%- endif -%}
											<div class="content-wrapper installation-text pt-1">
												{%- if page_object.content != blank -%}
													{{ page_object.content }}
												{%- else -%}
													{{ page_object }}
												{%- endif -%}
											</div>
										</div>
									</div>
								{%- endif -%}
						{%- endcase -%}
					</div>
				{%- endif -%}
			{%- endfor -%}
		</div>
	</div>
{%- endif -%}
{% schema %}
{
	"name": "Product Specification",
	"class": "section-product-specs",
	"tag": "section",
	"settings": [
		{
			"type": "header",
			"content": "Accordion Settings"
		},
		{
			"type": "checkbox",
			"id": "open_first",
			"label": "Open First Accordion Item?",
			"default": true
		},
		{
			"type": "header",
			"content": "Section Settings"
		},
		{
			"type": "select",
			"id": "padding_amount_top",
			"label": "Top Section Padding",
			"options": [
				{
					"value": "no",
					"label": "None"
				},
				{
					"value": "small",
					"label": "Small"
				},
				{
					"value": "default",
					"label": "Medium (Default)"
				},
				{
					"value": "large",
					"label": "Large"
				},
				{
					"value": "xlarge",
					"label": "Extra Large"
				}
			],
			"default": "default"
		},
		{
			"type": "select",
			"id": "padding_amount_bottom",
			"label": "Bottom Section Padding",
			"options": [
				{
					"value": "no",
					"label": "None"
				},
				{
					"value": "small",
					"label": "Small"
				},
				{
					"value": "default",
					"label": "Medium (Default)"
				},
				{
					"value": "large",
					"label": "Large"
				},
				{
					"value": "xlarge",
					"label": "Extra Large"
				}
			],
			"default": "default"
		}
	],
	"blocks": [
		{
			"type": "description",
			"name": "Description",
			"limit": 1,
			"settings": [
				{
					"type": "header",
					"content": "Product Description",
					"info": "Accordion content comes from current product description"
				},
				{
					"type": "text",
					"id": "heading",
					"label": "Accordion Heading"
				}
			]
		},
		{
			"type": "specification",
			"name": "Specifications",
			"limit": 1,
			"settings": [
				{
					"type": "header",
					"content": "Product Specification"
				},
				{
					"type": "text",
					"id": "heading",
					"label": "Accordion Heading"
				},
				{
					"type": "metaobject_list",
					"id": "spec_list",
					"label": "Specifications List",
					"metaobject_type": "product_specification",
					"limit": 3,
					"info": "Accordion content can be displayed using product specifications metafield"
				}
			]
		},
		{
			"type": "installation",
			"name": "Installation",
			"limit": 1,
			"settings": [
				{
					"type": "header",
					"content": "Product Installation"
				},
				{
					"type": "text",
					"id": "heading",
					"label": "Accordion Heading"
				},
				{
					"type": "richtext",
					"id": "content",
					"label": "Text Content",
					"info": "Will show regular text in case no new page have been selected"
				},
				{
					"type": "page",
					"id": "content_page",
					"label": "Content",
					"info": "Accordion content can be displayed using product installation metafield"
				}
			]
		}
	],
	"presets": [
		{ "name": "Product Specification" }
	],
	"enabled_on": {
		"templates": ["product"]
	}
}
{% endschema %}